<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArtMoots - Account</title>
<style>
:root{--bg:#f9f9f9;--text:#333;--accent:#111;--border:#ddd;}
body{font-family:"Segoe UI",Arial,sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:2rem;}
form{background:white;padding:2rem;border-radius:8px;width:320px;display:flex;flex-direction:column;gap:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
input{padding:0.6rem;border-radius:6px;border:1px solid var(--border);}
input:focus{border-color:var(--accent);}
button{background:var(--accent);color:white;border:none;padding:0.6rem;border-radius:6px;cursor:pointer;font-weight:500;}
button:hover{background:#222;}
.toggle{color:var(--accent);cursor:pointer;font-size:0.9rem;text-align:center;}
#accountInfo{display:none;background:white;padding:1.5rem;border-radius:8px;width:320px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
</style>
</head>
<body>

<h1>Welcome to ArtMoots</h1>

<!-- Sign-Up Form -->
<form id="signupForm">
  <h2>Sign Up</h2>
  <input type="text" id="signupName" placeholder="Full Name" required>
  <input type="email" id="signupEmail" placeholder="Email" required>
  <input type="password" id="signupPassword" placeholder="Password" required>
  <button type="submit">Create Account</button>
  <div class="toggle" onclick="toggleForms()">Already have an account? Log in</div>
</form>

<!-- Login Form -->
<form id="loginForm" style="display:none">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email" required>
  <input type="password" id="loginPassword" placeholder="Password" required>
  <button type="submit">Log In</button>
  <div class="toggle" onclick="toggleForms()">Don't have an account? Sign up</div>
</form>

<!-- Account Info -->
<div id="accountInfo">
  <h2>My Account</h2>
  <p id="accEmail"></p>
  <button id="logoutBtn">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDMBb5n4Tyf9XLSHU_7CZ1obDlHjzrw258",
  authDomain: "database-artmoots.firebaseapp.com",
  projectId: "database-artmoots",
  storageBucket: "database-artmoots.firebasestorage.app",
  messagingSenderId: "1056886155154",
  appId: "1:1056886155154:web:0de8b27263c11571ea034b",
  measurementId: "G-YX4MMZS1JB"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Elements
const signupForm = document.getElementById("signupForm");
const loginForm = document.getElementById("loginForm");
const accountInfo = document.getElementById("accountInfo");
const accEmail = document.getElementById("accEmail");
const logoutBtn = document.getElementById("logoutBtn");

// Toggle forms
function toggleForms(){
  signupForm.style.display = signupForm.style.display==="none"?"flex":"none";
  loginForm.style.display = loginForm.style.display==="none"?"flex":"none";
}

// Handle return URL and mode
const params = new URLSearchParams(window.location.search);
const mode = params.get("mode");
const returnPage = params.get("return") || "index.html";

// Show account info if signed in
onAuthStateChanged(auth, user => {
  if(user){
    signupForm.style.display="none";
    loginForm.style.display="none";
    accountInfo.style.display="block";
    accEmail.textContent = `Name: ${user.displayName || ""}\nEmail: ${user.email}`;
  } else {
    if(mode==="login"){ signupForm.style.display="none"; loginForm.style.display="flex"; }
    if(mode==="signup"){ signupForm.style.display="flex"; loginForm.style.display="none"; }
  }
});

// Sign Up with Display Name
signupForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("signupName").value.trim();
  const email = document.getElementById("signupEmail").value.trim();
  const password = document.getElementById("signupPassword").value;

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    
    // Set display name
    await updateProfile(cred.user, { displayName: name });

    // Store in Firestore (optional)
    await setDoc(doc(db, "users", cred.user.uid), { email, name });

    window.location.href = returnPage;
  } catch(error) {
    console.error(error);
    alert(error.message);
  }
});

// Login
loginForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;
  try {
    await signInWithEmailAndPassword(auth,email,password);
    window.location.href = returnPage;
  } catch(error){
    console.error(error);
    alert(error.message);
  }
});

// Logout
logoutBtn.addEventListener("click",()=> signOut(auth).then(()=> window.location.href="index.html"));
</script>

</body>
</html>
